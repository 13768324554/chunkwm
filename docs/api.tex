\documentclass[14pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{ragged2e}
\usepackage{fancyhdr}
\usepackage{float}
\usepackage{enumitem}
\usepackage{listings}
\usepackage{hyperref}
\author{koekeishiya}
\title{chunkwm docs}
\setlist[description]{style=nextline}
\pagestyle{fancy}
\fancyhf{}
\lhead{chunkwm plugin api v3}
\rfoot{Page \thepage}

\begin{document}
\RaggedRight

\begin{large}
\textbf{Plugin Structure}
\end{large}
\medskip
\\A chunkwm plugin consists of four essential parts. These are an init, deinit and main function, as well as a list of notifications that the plugin will subscribe to. In addition to the above, a plugin must provide both a name and a version.
\\\
\\The first step we have to do when creating a new plugin, is to include the necessary macros and definitions provided
through the plugin api:
\begin{lstlisting}[basicstyle=\tiny]
#include "../../api/plugin_api.h"
\end{lstlisting}
This file contains definitions for the init, deinit and main function as well as specifying the ABI version we are building against.
\\\
\\The init function gets called after a plugin has been loaded and the ABI version has been verified. The plugin is passed a pointer to a chunkwm function allowing it to broadcast custom notifications to other plugins.
\\\
\\The init function is defined through the PLUGIN\_BOOL\_FUNC macro and should return true if initialization succeeded, or false otherwise.
\begin{lstlisting}[basicstyle=\tiny]
/*
 * NOTE(koekeishiya):
 * parameter: plugin_broadcast *Broadcast
 * return: bool -> true if startup succeeded
 */
PLUGIN_BOOL_FUNC(PluginInit)
{
    plugin_broadcast *ChunkWMBroadcastEvent = Broadcast;
    
    //
    // initialization code
    //
    
    return true;
}
\end{lstlisting}
The deinit function is called when a plugin is unloaded and is responsible for teardown and cleanup. This function is defined through the PLUGIN\_VOID\_FUNC macro.
\begin{lstlisting}[basicstyle=\tiny]
PLUGIN_VOID_FUNC(PluginDeInit)
{
    //
    // deinitialization code
    //
}
\end{lstlisting}
The main function is invoked when the plugin is notified by chunkwm regarding system events or events broadcasted by other plugins.
This function is defined through the PLUGIN\_MAIN\_FUNC macro. The return value is currently unused, but should return true for events that were handled properly, and false otherwise.
\begin{lstlisting}[basicstyle=\tiny]
// contains definition of macos_application struct
#include "../../common/accessibility/application.h"

/*
 * NOTE(koekeishiya):
 * parameter: const char *Node
 * parameter: void *Data
 * return: bool
 * */
PLUGIN_MAIN_FUNC(PluginMain)
{
    if(strcmp(Node, "chunkwm_export_application_launched") == 0)
    {
        macos_application *Application = (macos_application *) Data;
        return true;
    }
    else if(strcmp(Node, "chunkwm_export_application_terminated") == 0)
    {
        macos_application *Application = (macos_application *) Data;
        return true;
    }

    return false;
}
\end{lstlisting}
After the above functions have been implemented, it is time to start constructing the plugin. The first thing we have to do is link our function pointers to the functions that we have implemented. This is done through 
\\the CHUNKWM\_PLUGIN\_VTABLE macro.
\begin{lstlisting}[basicstyle=\tiny]
// NOTE(koekeishiya): Initialize plugin function pointers.
CHUNKWM_PLUGIN_VTABLE(PluginInit, PluginDeInit, PluginMain)
\end{lstlisting}
Secondly, we tell our plugin which events that we want to subscribe to using the CHUNKWM\_PLUGIN\_SUBSCRIBE macro. The array can remain empty if no events are necessary for the plugin to do whatever it was made for.
\begin{lstlisting}[basicstyle=\tiny]
// NOTE(koekeishiya): Subscribe to ChunkWM events!
chunkwm_plugin_export Subscriptions[] =
{
    chunkwm_export_application_terminated,
    chunkwm_export_application_launched,
};
CHUNKWM_PLUGIN_SUBSCRIBE(Subscriptions)
\end{lstlisting}
Finally, we are ready to generate the plugin entry point used by chunkwm
\begin{lstlisting}[basicstyle=\tiny]
// NOTE(koekeishiya): Generate plugin
static const char *PluginName = "template";
static const char *PluginVersion = "0.0.2";
CHUNKWM_PLUGIN(PluginName, PluginVersion);
\end{lstlisting}
\href{https://github.com/koekeishiya/chunkwm/blob/master/src/plugins/template/plugin.cpp}{Click here to view full the full plugin template}
\\\bigskip
\begin{large}
\textbf{Notifications}
\end{large}
\medskip
\\\
\\\textbf{\textit{Application}}
\\\
\begin{description}
\item[chunkwm\_export\_application\_launched]
Fired when an interactable application is launched
\\\ \ \ \ param: macos\_application *
\item[chunkwm\_export\_application\_terminated]
Fired when an interactable application is terminated
\\\ \ \ \ param: macos\_application *
\item[chunkwm\_export\_application\_activated]
Fired when an interactable application is activated
\\\ \ \ \ param: macos\_application *
\item[chunkwm\_export\_application\_deactivated]
Fired when an interactable application is deactivated
\\\ \ \ \ param: macos\_application *
\item[chunkwm\_export\_application\_hidden]
Fired when an interactable application is hidden
\\\ \ \ \ param: macos\_application *
\item[chunkwm\_export\_application\_unhidden]
Fired when an interactable application is unhidden
\\\ \ \ \ param: macos\_application *
\medskip
\end{description}
\textbf{\textit{Window}}
\\\
\begin{description}
\item[chunkwm\_export\_window\_created]
Fired when a window is created
\\\ \ \ \ param: macos\_window *
\item[chunkwm\_export\_window\_destroyed]
Fired when a window is destroyed
\\\ \ \ \ param: macos\_window *
\item[chunkwm\_export\_window\_focused]
Fired when a window is given focus
\\\ \ \ \ param: macos\_window *
\item[chunkwm\_export\_window\_moved]
Fired when a window is moved
\\\ \ \ \ param: macos\_window *
\item[chunkwm\_export\_window\_resized]
Fired when a window is resized
\\\ \ \ \ param: macos\_window *
\item[chunkwm\_export\_window\_minimized]
Fired when a window is minimized
\\\ \ \ \ param: macos\_window *
\item[chunkwm\_export\_window\_deminimized]
Fired when a window is deminimized
\\\ \ \ \ param: macos\_window *
\medskip
\end{description}
\textbf{\textit{Display}}
\\\
\begin{description}
\item[chunkwm\_export\_display\_added]
Fired when a new display is detected
\\\ \ \ \ param: CGDirectDisplayID
\item[chunkwm\_export\_display\_removed]
Fired when a display is removed / disconnected
\\\ \ \ \ param: CGDirectDisplayID
\item[chunkwm\_export\_display\_moved]
Fired when a display is moved (arrangement changes)
\\\ \ \ \ param: CGDirectDisplayID
\item[chunkwm\_export\_display\_resized]
Fired when a display changes resolution
\\\ \ \ \ param: CGDirectDisplayID
\item[chunkwm\_export\_display\_changed]
Fired when the display which holds key-input changes
\medskip
\end{description}
\textbf{\textit{Space}}
\\\
\begin{description}
\item[chunkwm\_export\_space\_changed]
Fired after a space transition has finished
\medskip
\end{description}
\end{document}